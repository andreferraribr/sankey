---
title: "sankey"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


load libraries

```{r, load libraries}
library(dplyr)
library(networkD3)
library(tidyr)
library(readxl)
```

## teste
create two data frames: a) influx for revenue; b) outflux for outlays

guidence found here: [https://community.rstudio.com/t/read-xlsx-from-github/9386]
thanks to: Christophe Dervieux [https://community.rstudio.com/u/cderv/summary]

```{r, create influx data frame}
# import revenue from github
github_link <- "https://github.com/andreferraribr/sankey/blob/master/rec.xlsx?raw=true"
library(httr)
temp_file_in <- tempfile(fileext = ".xlsx")
req <- GET(github_link, 
          # authenticate using GITHUB_PAT
           authenticate(Sys.getenv("GITHUB_PAT"), ""),
          # write result to disk
           write_disk(path = temp_file_in))
# create data frame influx with revenue data
influx <- readxl::read_excel(temp_file_in)


```
```{r, check influx data frame}
## change names of the columns to increase readability
colnames(influx)<- c("origem","origem_cod","especie","especie_cod","fonte","fonte_cod","ano","esfera_cod","esfera","influx_reais","influx_ipca","influx_pib")

# summary influx
summary(influx)
str(influx)
tail(influx)
```



```{r, create outflux data frame}
# import outlays from github
github_link <- "https://github.com/andreferraribr/sankey/blob/master/out.xlsx?raw=true"
library(httr)
temp_file_out <- tempfile(fileext = ".xlsx")
req <- GET(github_link, 
          # authenticate using GITHUB_PAT
           authenticate(Sys.getenv("GITHUB_PAT"), ""),
          # write result to disk
           write_disk(path = temp_file_out))
# create data frame outflux with outlays data
outflux <- readxl::read_excel(temp_file_out)

```
outflux is the outlay either in reais (current BRL), IPCA (Inflation) or PIB (GDP).


```{r, check outflux data frame}

## change names of the columns to increase readability

colnames(outflux)<-c("ano","cat_cod","cat","gnd_cod","gnd","elemento_cod","elemento","esfera_cod","esfera","fonte_cod","fonte","res_primario_cod","res_primario","outflux_reais","outflux_ipca", "outflux_pib")

summary(outflux)
str(outflux)
tail(outflux)

```

